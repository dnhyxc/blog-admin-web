var me=Object.defineProperty,ge=Object.defineProperties;var be=Object.getOwnPropertyDescriptors;var le=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable;var se=(g,n,l)=>n in g?me(g,n,{enumerable:!0,configurable:!0,writable:!0,value:l}):g[n]=l,O=(g,n)=>{for(var l in n||(n={}))he.call(n,l)&&se(g,l,n[l]);if(le)for(var l of le(n))we.call(n,l)&&se(g,l,n[l]);return g},j=(g,n)=>ge(g,be(n));var F=(g,n,l)=>new Promise((v,t)=>{var h=w=>{try{c(l.next(w))}catch(y){t(y)}},$=w=>{try{c(l.throw(w))}catch(y){t(y)}},c=w=>w.done?v(w.value):Promise.resolve(w.value).then(h,$);c((l=l.apply(g,n)).next())});import{M as Ue}from"./index-31e04a31.js";import{d as X,aJ as u,c as ae,aK as re,b2 as D,o as x,j as ye,w as a,g as p,i as e,bg as ke,aM as xe,f as T,h as _,F as P,r as W,b6 as J,A as B,l as de,aU as N,bu as Ce,bd as ce,bc as ue,b3 as Z,E as Te,aX as Ee,_ as Q,bb as ne,aL as Se,be as $e,bf as He,aW as Ne,b4 as Ve,bt as Le,b5 as Be,b7 as Me,T as ie}from"./index-c3904695.js";import"./el-infinite-scroll-4ed993c7.js";import{_ as Y}from"./index-9942da33.js";/* empty css                *//* empty css                  *//* empty css                     *//* empty css                 */import{a as C,t as m}from"./index-fe386976.js";/* empty css                 *//* empty css                  *//* empty css                  *//* empty css                        *//* empty css                    */import"./el-tooltip-4ed993c7.js";import{d as Re,f as Fe}from"./index-11a757ea.js";import{M as Ie}from"./index-cf4ffd93.js";/* empty css                     */import{U as Ae}from"./index-61c789b9.js";import{l as De}from"./lodash-4d475c0b.js";/* empty css                   *//* empty css                   *//* empty css                    */const Pe="/assets/svg/tool-96b8e626.svg",Ke={class:"left"},qe={class:"search"},ze={class:"scroll"},Ge=["infinite-scroll-disabled"],Oe=["onClick"],je={class:"right"},Je={class:"select-info"},We={class:"user-count"},Xe={class:"user-list"},Ze={class:"selected-user"},Qe=X({__name:"index",props:{selectedUsers:null,visible:{type:Boolean}},setup(g,{expose:n}){const l=g,v=u(""),t=u(!1),h=ae(()=>{var r;return((r=C.userList)==null?void 0:r.length)>=C.total}),$=ae(()=>C.loading||h.value),c=u(l.selectedUsers||[]);re(()=>{t.value=!0,C.getUserListByScroll(v.value)}),D(()=>l.visible,r=>{var b;r&&((b=l==null?void 0:l.selectedUsers)!=null&&b.length)&&(c.value=[...l==null?void 0:l.selectedUsers])});const w=()=>{C.getUserListByScroll(v.value)},y=()=>{C.clearUserListInfo(),C.getUserListByScroll(v.value)},V=r=>{c.value.find(E=>E.id===r.id)||(c.value=[...c.value,r])},o=r=>{c.value=c.value.filter(b=>b.id!==r.id)},f=()=>{c.value=[]};return n({selectedUsers:c,onRemoveAll:f}),(r,b)=>{const E=ce,L=ue,M=Z,S=Te,K=Y,q=Ee;return x(),ye(K,{loading:_(C).loading,class:"select-user-wrap"},{default:a(()=>[p("div",Ke,[p("div",qe,[e(E,{modelValue:v.value,"onUpdate:modelValue":b[0]||(b[0]=k=>v.value=k),placeholder:"请输入用户名称",onKeyup:ke(y,["enter"])},null,8,["modelValue","onKeyup"])]),p("div",ze,[e(L,{ref:"scrollRef"},{default:a(()=>[t.value?xe((x(),T("div",{key:0,"infinite-scroll-disabled":_($),"infinite-scroll-immediate":"","infinite-scroll-distance":"2",class:"user-list"},[(x(!0),T(P,null,W(_(C).userList,k=>(x(),T("div",{key:k.id,class:"user-item",onClick:J(z=>V(k),["stop"])},B(k.username),9,Oe))),128))],8,Ge)),[[q,w]]):de("",!0)]),_:1},512)])]),p("div",je,[p("div",Je,[p("span",We,"已选："+B(c.value.length)+" 位",1),e(M,{link:"",type:"primary",onClick:J(f,["stop"])},{default:a(()=>[N("清空")]),_:1},8,["onClick"])]),p("div",Xe,[e(L,{ref:"scrollRef"},{default:a(()=>[(x(!0),T(P,null,W(c.value,k=>(x(),T("div",{key:k.id,class:"user-item"},[p("span",Ze,B(k.username),1),e(S,{class:"delete",onClick:J(z=>o(k),["stop"])},{default:a(()=>[e(_(Ce))]),_:2},1032,["onClick"])]))),128))]),_:1},512)])])]),_:1},8,["loading"])}}});const Ye=Q(Qe,[["__scopeId","data-v-3e7318fc"]]),eo={class:"add-tools-wrap"},oo=["src"],to=X({__name:"index",props:{selectedItem:null,addVisible:{type:Boolean}},setup(g,{expose:n}){const l=g,v=u(),t=ne({toolName:"",toolHref:"",toolUrl:"",powerUsers:[]}),h=u(""),c=ne({toolHref:[{validator:(o,f,r)=>{f===""?r(new Error("用户名不能为空")):Re(f)?r():r(new Error("请输入正确的链接"))},trigger:"blur",required:!0}]});Se(()=>{const{selectedItem:o}=l;o!=null&&o.toolName&&(t.toolName=o==null?void 0:o.toolName,t.toolHref=o==null?void 0:o.toolHref,t.toolUrl=o==null?void 0:o.toolUrl,t.powerUsers=o==null?void 0:o.powerUsers,h.value=(o==null?void 0:o.toolUrl)||"")}),D(()=>l.addVisible,o=>{o||(t.toolName="",t.toolHref="",t.toolUrl="",t.powerUsers=[],V())});const w=De.exports.debounce(()=>F(this,null,function*(){if(t.toolHref){const{title:o,iconUrl:f}=yield m.getPageInfo(t.toolHref);t.toolName=o,t.toolUrl=f,h.value=f}}),500),y=o=>{t.toolHref=o,w()},V=()=>{h.value=""};return n({formRef:v,addToolsForm:t,clearToolUrl:V,toolUrl:h}),(o,f)=>{const r=Ae,b=Z,E=$e,L=ce,M=He;return x(),T("div",eo,[e(M,{ref_key:"formRef",ref:v,rules:c,"label-width":"79px",model:t,class:"form-wrap"},{default:a(()=>[e(E,{prop:"tooUrl",label:"工具图标",class:"form-item"},{default:a(()=>[e(Y,{loading:_(m).pageLoading,text:"正在自动获取图标...",class:"cover-img-wrap"},{default:a(()=>[e(r,{"file-path":h.value,"onUpdate:file-path":f[0]||(f[0]=S=>h.value=S),"fixed-number":[130,130],delete:""},{preview:a(()=>[p("img",{src:h.value,class:"cover-img avatar"},null,8,oo)]),_:1},8,["file-path"])]),_:1},8,["loading"]),e(b,{link:"",class:"reload",disabled:_(m).pageLoading,onClick:_(w)},{default:a(()=>[N("重新获取图标")]),_:1},8,["disabled","onClick"])]),_:1}),e(E,{prop:"toolHref",label:"工具链接",class:"form-item"},{default:a(()=>[e(L,{modelValue:t.toolHref,"onUpdate:modelValue":f[1]||(f[1]=S=>t.toolHref=S),placeholder:"请输入工具链接",onInput:y},null,8,["modelValue"])]),_:1}),e(E,{prop:"toolName",label:"工具名称",rules:[{required:!0,message:"请输入工具名称"}],class:"form-item"},{default:a(()=>[e(L,{modelValue:t.toolName,"onUpdate:modelValue":f[2]||(f[2]=S=>t.toolName=S),placeholder:"请输入工具名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["rules","model"])])}}});const lo=Q(to,[["__scopeId","data-v-5db2f134"]]),so={class:"action-list"},ao={class:"user-info"},no={class:"username"},io=["href"],ro={class:"tool-users"},co={key:0,class:"power"},uo={class:"actions"},_o={class:"footer"},po={class:"select-user-modal-content"},fo={class:"add-tools-modal-content"},vo=X({__name:"index",setup(g){const n=u(null),l=u(null),v=u(!1),t=u(!1),h=u(),$=u([]),c=u(1),w=u(!1),y=u(!1),V=u(""),o=u([]),f=u(),r=u(""),b=u({toolHref:"",toolName:"",toolUrl:"",powerUsers:[],id:""});re(()=>{m.getToolList()}),Ne(()=>{C.clearUserListInfo()}),D(c,(s,d)=>{m.pageNo=s,m.getToolList(s)}),D(v,s=>{if(!s){const{onRemoveAll:d}=n.value;d==null||d()}});const E=s=>{$.value=s},L=s=>{v.value=!0;const{id:d,powerUsers:U}=s;r.value=d,f.value=U},M=s=>{r.value=s.id,b.value=s,t.value=!0},S=s=>{V.value=s,y.value=!0},K=()=>{const s=$.value.map(d=>d.id)||[];o.value=s,y.value=!0},q=()=>F(this,null,function*(){yield m.deleteTools(o.value.length?o.value:[V.value]),o.value=[],h.value.clearSelection()}),k=()=>{v.value=!1;const{selectedUsers:s}=n.value,d=s.map(U=>({id:U.id,username:U.username}));m.updateTools({powerUsers:d,id:r.value})},z=()=>{t.value=!0},_e=()=>F(this,null,function*(){const{formRef:s,addToolsForm:d,clearToolUrl:U,toolUrl:H}=l.value,I=j(O({},d),{toolUrl:H});s==null||s.validate(G=>F(this,null,function*(){var A;if(G)(A=b.value)!=null&&A.id?yield m.updateTools(j(O({},I),{id:r.value})):yield m.addTools(I),s==null||s.resetFields(),U==null||U(),t.value=!1,b.value={};else return!1}))}),pe=s=>{c.value=s};return(s,d)=>{const U=Z,H=Ve,I=Le,G=Be,A=ue,fe=Y,ve=Ye,ee=Ue;return x(),T(P,null,[e(fe,{loading:_(m).loading,class:"tools-wrap"},{default:a(()=>[p("div",so,[e(U,{type:"primary",onClick:z},{default:a(()=>[N("添加工具")]),_:1}),e(U,{type:"danger",disabled:!$.value.length,onClick:K},{default:a(()=>[N("批量删除")]),_:1},8,["disabled"])]),e(A,{class:"content"},{default:a(()=>[e(_(Me),{ref_key:"multipleTableRef",ref:h,data:_(m).list,style:{width:"100%"},onSelectionChange:E},{default:a(()=>[e(H,{type:"selection",width:"55"}),e(H,{label:"工具名称","show-overflow-tooltip":"",width:"220"},{default:a(i=>[p("div",ao,[e(I,{style:{width:"50px",height:"50px","min-width":"50px","border-radius":"5px"},src:i.row.toolUrl||_(Pe),fit:"cover"},null,8,["src"]),p("span",no,B(i.row.toolName),1)])]),_:1}),e(H,{property:"toolHref",label:"工具链接","min-width":"300"},{default:a(i=>[p("a",{href:i.row.toolHref,class:"tool-herf",target:"_blank"},B(i.row.toolHref),9,io)]),_:1}),e(H,{property:"createTime",label:"添加时间","show-overflow-tooltip":"",width:"180"},{default:a(i=>[N(B(_(Fe)(i.row.createTime)),1)]),_:1}),e(H,{property:"powerUsers",label:"权限范围","show-overflow-tooltip":"",width:"280"},{default:a(i=>{var R,oe;return[p("div",ro,[(x(!0),T(P,null,W(i.row.powerUsers,te=>(x(),T("div",{key:te.id,class:"power"},[p("span",null,B(te.username),1)]))),128)),(oe=(R=i.row)==null?void 0:R.powerUsers)!=null&&oe.length?de("",!0):(x(),T("div",co,"全员可见"))])]}),_:1}),e(H,{label:"操作",width:"175"},{default:a(i=>[p("div",uo,[e(U,{link:"",type:"primary",onClick:R=>L(i.row)},{default:a(()=>[N("权限设置")]),_:2},1032,["onClick"]),e(U,{link:"",type:"primary",onClick:R=>M(i.row)},{default:a(()=>[N("编辑")]),_:2},1032,["onClick"]),e(U,{link:"",type:"danger",onClick:R=>S(i.row.id)},{default:a(()=>[N("删除")]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"]),p("div",_o,[e(G,{"current-page":_(m).pageNo,"onUpdate:current-page":d[0]||(d[0]=i=>_(m).pageNo=i),"page-size":_(ie),background:"",disabled:w.value,layout:"total, prev, pager, next",total:_(m).total,"hide-on-single-page":_(m).list.length<=_(ie),onCurrentChange:pe},null,8,["current-page","page-size","disabled","total","hide-on-single-page"])])]),_:1})]),_:1},8,["loading"]),e(Ie,{visible:y.value,"onUpdate:visible":d[1]||(d[1]=i=>y.value=i),title:"删除工具",content:"确定删除工具吗？",info:"删除后，该工具将无法恢复！","on-submit":q},null,8,["visible"]),e(ee,{visible:v.value,"onUpdate:visible":d[2]||(d[2]=i=>v.value=i),title:"选择用户",width:550,"content-padding":"0","on-submit":k},{default:a(()=>[p("div",po,[e(ve,{ref_key:"selectUserRef",ref:n,"selected-users":f.value,visible:v.value},null,8,["selected-users","visible"])])]),_:1},8,["visible"]),e(ee,{visible:t.value,"onUpdate:visible":d[3]||(d[3]=i=>t.value=i),title:"添加工具",width:550,"content-padding":"20px 20px 0","on-submit":_e,disabled:_(m).pageLoading},{default:a(()=>[p("div",fo,[e(lo,{ref_key:"addToolsRef",ref:l,"add-visible":t.value,"selected-item":b.value},null,8,["add-visible","selected-item"])])]),_:1},8,["visible","disabled"])],64)}}});const Do=Q(vo,[["__scopeId","data-v-674c8542"]]);export{Do as default};
