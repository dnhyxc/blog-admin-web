var E=(V,m,o)=>new Promise((i,v)=>{var N=s=>{try{n(o.next(s))}catch(g){v(g)}},C=s=>{try{n(o.throw(s))}catch(g){v(g)}},n=s=>s.done?i(s.value):Promise.resolve(s.value).then(N,C);n((o=o.apply(V,m)).next())});import{d as q,aJ as h,c as T,bp as J,aK as K,bq as X,bc as z,br as G,aX as H,o as r,j as S,w as L,i as w,f as y,aM as O,h as x,F as P,r as Q,g as W,A as Y,l as k,_ as Z}from"./index-c3904695.js";import"./el-infinite-scroll-4ed993c7.js";import{_ as $}from"./index-9942da33.js";import{_ as j}from"./index-09de227e.js";/* empty css                     */import{f as I}from"./index-fe386976.js";import{s as ee}from"./index-11a757ea.js";import{u as te}from"./index-cfc8d944.js";import{C as oe}from"./index-59c9448f.js";/* empty css                   *//* empty css                *//* empty css                  *//* empty css                  */import"./index-cf4ffd93.js";/* empty css                   */const le={key:0,class:"infinite-list-wrapper"},se=["infinite-scroll-disabled"],ae={class:"title"},ie={key:0,class:"loading"},ne={key:1,class:"no-more"},ce=q({__name:"index",setup(V){const m=h([]),o=h({list:[],total:0}),i=h(!1),v=T(()=>o.value.list.length>=o.value.total),N=T(()=>i.value||v.value),C=h(!1),n=h(1),{scrollRef:s,scrollTop:g}=te();J(()=>{I.comments=[]}),K(()=>E(this,null,function*(){C.value=!0,i.value=!0;const e=yield I.getArticlesComments({pageNo:n.value});i.value=!1,o.value=e,o.value.list.length<(e==null?void 0:e.total)&&n.value++,m.value=(e==null?void 0:e.list.filter(a=>{var l;return(l=a.commentList)==null?void 0:l.comments.length}).map(a=>a.id))||[]}));const D=b=>E(this,[b],function*({comment:e,isRestore:a,isDelete:l}){l&&o.value.list.forEach(c=>{var d,u,p;(u=(d=c.commentList)==null?void 0:d.comments)!=null&&u.length&&((p=c.commentList)==null||p.comments.forEach((t,_)=>{var f,B;if(t.id===e.id&&l){(f=c.commentList)==null||f.comments.splice(_,1);return}(B=t.replyList)!=null&&B.length&&t.replyList.forEach((F,R)=>{var M;F._id===e._id&&l&&((M=t.replyList)==null||M.splice(R,1))})}))}),o.value.list.forEach(c=>{var d,u,p;(u=(d=c.commentList)==null?void 0:d.comments)!=null&&u.length&&((p=c.commentList)==null||p.comments.forEach(t=>{var _;if(t.id===e.id){t.isDelete=!t.isDelete;return}(_=t.replyList)!=null&&_.length&&t.replyList.forEach(f=>{f._id===e._id&&(a?f.isDelete=!1:f.isDelete=!0)})}))})}),A=()=>E(this,null,function*(){i.value=!0;const e=yield I.getArticlesComments({pageNo:n.value});i.value=!1,o.value={list:[...o.value.list,...e==null?void 0:e.list],total:e==null?void 0:e.total};const a=(e==null?void 0:e.list.filter(l=>{var b;return(b=l.commentList)==null?void 0:b.comments.length}).map(l=>l.id))||[];m.value=[...m.value,...a],o.value.list.length<(e==null?void 0:e.total)&&n.value++}),U=()=>{ee(s,0)};return(e,a)=>{const l=X,b=z,c=G,d=j,u=$,p=H;return r(),S(u,{loading:x(I).loading,class:"comment"},{default:L(()=>[w(c,{modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=t=>m.value=t),class:"el-collapse"},{default:L(()=>[w(b,{ref_key:"scrollRef",ref:s,class:"tag-list"},{default:L(()=>[C.value?(r(),y("div",le,[O((r(),y("div",{class:"list","infinite-scroll-disabled":x(N),"infinite-scroll-immediate":"","infinite-scroll-distance":"5"},[(r(!0),y(P,null,Q(o.value.list,t=>(r(),S(l,{key:t.id,name:t.id,class:"collapse-item"},{title:L(()=>[W("div",ae,Y(t.title),1)]),default:L(()=>[w(oe,{"comment-list":t.commentList,"onUpdate:comment-list":_=>t.commentList=_,"article-id":t.authorId,"author-id":t.authorId,class:"comment-detail","reset-comment-list":D},null,8,["comment-list","onUpdate:comment-list","article-id","author-id"])]),_:2},1032,["name"]))),128))],8,se)),[[p,A]]),i.value?(r(),y("p",ie,"Loading...")):k("",!0),x(v)?(r(),y("p",ne,"没有更多了～～～")):k("",!0)])):k("",!0)]),_:1},512)]),_:1},8,["modelValue"]),x(g)>=500?(r(),S(d,{key:0,"on-scroll-to":U})):k("",!0)]),_:1},8,["loading"])}}});const ke=Z(ce,[["__scopeId","data-v-33de5a6b"]]);export{ke as default};
