var J=(p,v,l)=>new Promise((_,i)=>{var e=s=>{try{c(l.next(s))}catch(u){i(u)}},r=s=>{try{c(l.throw(s))}catch(u){i(u)}},c=s=>s.done?_(s.value):Promise.resolve(s.value).then(e,r);c((l=l.apply(p,v)).next())});import{d as L,aJ as x,bb as ce,c as B,aL as ie,b2 as re,bB as N,bP as de,o as n,f as b,i as w,w as k,g as a,A as T,h as o,j as m,l as g,aM as ee,b1 as te,ba as _e,bQ as ue,b8 as pe,_ as V,aK as W,N as oe,W as ve,u as fe,E as me,bR as he,bS as ge,bT as ye,aU as P,F as U,r as G,bU as we,bV as ke,k as xe,m as Ie,n as be,p as Te,q as Me,s as Ce,t as Se,x as Ee,y as $e,v as Re,z as De,B as K,M as Q,S as Ae,C as se,D as ae,aW as ne,b0 as X,a as Ne,bj as Le,bt as Ve,a_ as Pe,J as We}from"./index-c3904695.js";/* empty css                   *//* empty css                   */import"./el-tooltip-4ed993c7.js";/* empty css                  */import{_ as Be}from"./index-09de227e.js";/* empty css                        *//* empty css                  */import{j as d,u as Y,f as Z}from"./index-fe386976.js";import{f as Ue,d as Ge}from"./index-11a757ea.js";/* empty css                  *//* empty css                     *//* empty css                */import{S as He}from"./sea-fba9205e.js";import{C as ze}from"./index-59c9448f.js";import{_ as qe}from"./lodash-4d475c0b.js";import"./index-cf4ffd93.js";const Oe={class:"prev-dialog-wrap"},Fe={class:"actions"},je={class:"title"},Je={class:"icon-list"},Ke={class:"image-preview-wrap"},Qe=["src"],Xe=L({__name:"index",props:{selectImage:null,previewVisible:{type:Boolean},showPrevAndNext:{type:Boolean},showWaterModal:null,title:null,prevImgs:null,closeOnClickModal:{type:Boolean}},emits:["update:previewVisible"],setup(p,{emit:v}){const l=p,_=x(l.selectImage),i=x(null),e=ce({scale:1,rotate:0,boundary:!0,imgWidth:0,imgHeight:0}),r=x(!1),c=x(!1),s=B({get(){return l.previewVisible},set(t){v("update:previewVisible",t),_.value=l.selectImage,S()}}),u=B(()=>l.prevImgs||[]);ie(()=>{_.value=l.selectImage}),re(()=>[e.scale,e.rotate],t=>{t[0]!==1&&N(()=>{i.value.style.cursor="move"}),t[1]!==0?N(()=>{i.value.style.cursor="move"}):i.value.style.cursor="default"});const M=()=>{var t;(t=l==null?void 0:l.showWaterModal)==null||t.call(l)},h=()=>{if(e.scale>=5){r.value=!0;return}c.value=!1,e.scale+=.2,e.imgWidth=Math.round(i.value.width*e.scale),e.imgHeight=Math.round(i.value.height*e.scale)},f=()=>{if(e.scale<=1.2&&(i.value.style.top="0",i.value.style.left="0"),e.scale<=.4){c.value=!0;return}r.value=!1,e.scale-=.2,e.imgWidth=Math.round(i.value.width*e.scale),e.imgHeight=Math.round(i.value.height*e.scale)},R=()=>{e.rotate>=315?(e.rotate=0,i.value.style.top="0",i.value.style.left="0"):e.rotate+=45},S=()=>{e.scale=1,e.rotate=0,i.value.style.top="0",i.value.style.left="0"},D=()=>{S();let t;const I=u.value.findIndex(y=>{var C;return(y==null?void 0:y.id)===((C=_==null?void 0:_.value)==null?void 0:C.id)});I===0?t=u.value.length-1:t=I-1,_.value=u.value[t]},A=()=>{var y,C;S();let t;const I=(y=u.value)==null?void 0:y.findIndex($=>{var E;return $.id===((E=_==null?void 0:_.value)==null?void 0:E.id)});I===((C=u.value)==null?void 0:C.length)-1?t=0:t=I+1,_.value=u.value[t]};return(t,I)=>{const y=ue,C=pe,$=de("move");return n(),b("div",Oe,[w(C,{modelValue:o(s),"onUpdate:modelValue":I[0]||(I[0]=E=>_e(s)?s.value=E:null),"close-on-click-modal":p.closeOnClickModal||!1,"align-center":"",width:"88vw",onClose:M},{header:k(()=>[a("div",Fe,[a("span",je,T(p.title||"图片预览"),1),a("div",Je,[w(y,{effect:"light",content:r.value?"不能再大了":"放大",placement:"top","popper-class":"custom-dropdown-styles"},{default:k(()=>[a("i",{class:"font iconfont icon-fangda",onClick:h})]),_:1},8,["content"]),w(y,{effect:"light",content:c.value?"不能再小了":"缩小",placement:"top","popper-class":"custom-dropdown-styles"},{default:k(()=>[a("i",{class:"font iconfont icon-suoxiao",onClick:f})]),_:1},8,["content"]),w(y,{effect:"light",content:"旋转",placement:"top","popper-class":"custom-dropdown-styles"},{default:k(()=>[a("i",{class:"font iconfont icon-rotate",onClick:R})]),_:1}),w(y,{effect:"light",content:"重置",placement:"top","popper-class":"custom-dropdown-styles"},{default:k(()=>[a("i",{class:"font iconfont icon-zhongzhi1",onClick:S})]),_:1}),p.showPrevAndNext&&o(u).length>1?(n(),m(y,{key:0,effect:"light",content:"上一张",placement:"top","popper-class":"custom-dropdown-styles"},{default:k(()=>[a("i",{class:"font iconfont icon-arrow-left-bold",onClick:D})]),_:1})):g("",!0),p.showPrevAndNext&&o(u).length>1?(n(),m(y,{key:1,effect:"light",content:"下一张",placement:"top","popper-class":"custom-dropdown-styles"},{default:k(()=>[a("i",{class:"font iconfont icon-arrow-right-bold",onClick:A})]),_:1})):g("",!0)])])]),default:k(()=>[a("div",Ke,[ee(a("img",{ref_key:"imgRef",ref:i,src:_.value.url,alt:"",class:"preview-img",style:te({transform:`rotate(${e.rotate}deg) scale(${e.scale})`})},null,12,Qe),[[$,e,void 0,{imageInfo:!0}]])])]),_:1},8,["modelValue","close-on-click-modal"])])}}});const Ye=V(Xe,[["__scopeId","data-v-4c8ad929"]]),Ze={class:"preview-wrap"},et=L({__name:"index",props:{mackdown:{default:""},onPreviewImage:{type:Function,default:p=>{}}},setup(p){const v=p,l=x(null);W(()=>{if(d.previewRef){const e=d.previewRef.querySelectorAll("h1,h2,h3,h4,h5,h6"),r=Array.from(e).filter(s=>!!s.innerText.trim());if(!r.length){d.tocTitles=[];return}d.titles=r;const c=Array.from(new Set(r.map(s=>s.tagName))).sort();d.tocTitles=r.map(s=>({title:s.innerText,lineIndex:s.getAttribute("data-v-md-line"),indent:c.indexOf(s.tagName)}))}N(()=>{l.value.$el.addEventListener("click",_)})});const _=e=>{var s;e.preventDefault();const r=e.target;if(r.tagName==="A"){window.open(r.href);return}if(r.closest("a")){const u=r.parentNode;window.open(u==null?void 0:u.href);return}const c=e.target;c.tagName==="IMG"&&((s=v==null?void 0:v.onPreviewImage)==null||s.call(v,{target:{id:"__COMMENT_IMG__",src:c.src,tagName:"IMG"}}))},i=e=>{ve.success("复制成功")};return(e,r)=>{const c=oe("v-md-preview");return n(),b("div",Ze,[w(c,{id:"__MD_PREVIEW__",ref_key:"previewRef",ref:l,text:p.mackdown,"default-show-toc":"",onCopyCodeSuccess:i},null,8,["text"])])}}});const tt=V(et,[["__scopeId","data-v-ff57d2ef"]]);const ot=p=>(se("data-v-ac0dca44"),p=p(),ae(),p),st={class:"container"},at=["src"],nt={key:0,class:"menuList"},lt={class:"el-dropdown-link"},ct=ot(()=>a("span",{class:"current-menu"},"文章详情",-1)),it={class:"link-name"},rt=L({__name:"index",setup(p){const v=fe(),l=B(()=>Y.auth===K.SUPER?Q:Q.filter(h=>Y.auth===K.ADMIN?h.key!=="users"&&h.key!=="account":!Ae.includes(h.key))),_=x(document.body.clientWidth),i=x(!1),e=x();W(()=>{r()});const r=()=>{window.addEventListener("resize",()=>{_.value=document.body.clientWidth})},c=()=>{v.push("/home")},s=M=>{M?i.value=!0:i.value=!1},u=M=>{e.value=M,v.push(M.path)};return(M,h)=>{const f=me,R=he,S=ge,D=ye,A=oe("router-link");return n(),b("div",st,[a("div",{class:"title",onClick:c},[a("img",{src:o(He),alt:"",class:"icon"},null,8,at),P(" 墨客管理 ")]),_.value<=1150?(n(),b("div",nt,[w(D,{trigger:"click",onVisibleChange:s},{dropdown:k(()=>[w(S,null,{default:k(()=>[(n(!0),b(U,null,G(o(l),t=>(n(),m(R,{key:t.key,icon:t.icon,onClick:I=>u(t)},{default:k(()=>[P(T(t.name),1)]),_:2},1032,["icon","onClick"]))),128))]),_:1})]),default:k(()=>[a("span",lt,[ct,w(f,{class:"el-icon-right"},{default:k(()=>[i.value?(n(),m(o(ke),{key:1})):(n(),m(o(we),{key:0}))]),_:1})])]),_:1})])):(n(!0),b(U,{key:1},G(o(l),t=>(n(),b("div",{key:t.key,class:"menuList"},[w(A,{class:"link",to:t.path},{default:k(()=>[w(f,{class:"icon"},{default:k(()=>[t.key==="home"?(n(),m(o(xe),{key:0})):g("",!0),t.key==="article"?(n(),m(o(Ie),{key:1})):g("",!0),t.key==="classify"?(n(),m(o(be),{key:2})):g("",!0),t.key==="tag"?(n(),m(o(Te),{key:3})):g("",!0),t.key==="account"?(n(),m(o(Me),{key:4})):g("",!0),t.key==="users"?(n(),m(o(Ce),{key:5})):g("",!0),t.key==="comment"?(n(),m(o(Se),{key:6})):g("",!0),t.key==="pageSet"?(n(),m(o(Ee),{key:7})):g("",!0),t.key==="create"?(n(),m(o($e),{key:8})):g("",!0),t.key==="interact"?(n(),m(o(Re),{key:9})):g("",!0),t.key==="tools"?(n(),m(o(De),{key:10})):g("",!0)]),_:2},1024),a("span",it,T(t.name),1)]),_:2},1032,["to"])]))),128))])}}});const dt=V(rt,[["__scopeId","data-v-ac0dca44"]]),_t=p=>(se("data-v-a61a6dcb"),p=p(),ae(),p),ut=_t(()=>a("div",{class:"title"},"目录",-1)),pt=["onClick"],vt=L({__name:"index",setup(p){const v=x(""),l=x(null),_=qe.debounce(()=>{const e=document.querySelector("#__DETAIL__");if(e&&l.value){const{scrollHeight:r,scrollTop:c}=e,s=c/r;l.value.scrollTop=l.value.scrollHeight*s}},10);W(()=>{v.value=d.tocTitles[0].title+0;const e=document.querySelector("#__DETAIL__");e==null||e.addEventListener("scroll",_)}),ne(()=>{const e=document.querySelector("#__DETAIL__");e==null||e.removeEventListener("scroll",_)});const i=(e,r)=>{const{lineIndex:c,title:s}=e;v.value=s+r;const u=d.previewRef.querySelector(`[data-v-md-line="${c}"]`);u&&(u.classList.add("header-active"),d.previewRef.scrollTo({top:u.offsetTop-5,behavior:"smooth"}))};return(e,r)=>(n(),b("div",{ref_key:"tocRef",ref:l,class:"toc-wrap"},[ut,(n(!0),b(U,null,G(o(d).tocTitles,(c,s)=>(n(),b("div",{key:s,style:te({padding:`10px 0 10px ${c.indent*20+5}px`}),class:X(v.value===c.title+s&&"toc-item"),onClick:u=>i(c,s)},[a("a",{style:{cursor:"pointer"},class:X(v.value===c.title+s&&"active")},T(c.title),3)],14,pt))),128))],512))}});const ft=V(vt,[["__scopeId","data-v-a61a6dcb"]]),mt={id:"__DETAIL__",class:"detail-wrap"},ht={class:"prewiew"},gt={class:"header"},yt={class:"info"},wt={class:"avatar"},kt={class:"art-info"},xt={class:"username"},It={class:"read-info"},bt={class:"time"},Tt={class:"read-count"},Mt={class:"coverImg"},Ct={class:"abstract"},St={class:"classify-tags"},Et={class:"tags"},$t={class:"classify"},Rt={class:"tags"},Dt={class:"classify"},At={key:0,target:"#__DETAIL__",offset:60,class:"toc-affix"},Nt=L({__name:"index",setup(p){const v=Ne(),l=x(""),_=x(null),i=x(0),e=x(!1),r=x("");W(()=>J(this,null,function*(){N(()=>{d.setPreviewRef(_.value)});const{id:h}=v.params;if(h){const f=yield d.getArticleDetail(h);l.value=f==null?void 0:f.content,Z.getCommentList(h)}})),ne(()=>{d.clearDetail(),Z.clearComment()});const c=h=>{const f=h.target;if(f!=null&&f.innerText&&Ge(f.innerText)){window.open(f.innerText);return}f.id==="__COMMENT_IMG__"&&(e.value=!0,r.value=f.src)},s=h=>{i.value=h.target.scrollTop},u=()=>{N(()=>{var h;(h=_.value)==null||h.scrollTo({top:0,behavior:"smooth"})})},M=()=>!0;return(h,f)=>{var I,y,C,$,E,H,z,q,O,F,j;const R=Le,S=Ve,D=Be,A=Ye,t=Pe;return ee((n(),b("div",mt,[w(dt,{class:"top-menu"}),a("div",{ref_key:"detailWrapRef",ref:_,class:"content",onScroll:s},[a("div",ht,[a("div",gt,T((I=o(d).detail)==null?void 0:I.title),1),a("div",yt,[a("div",wt,[w(R,{size:60,fit:"cover",src:((y=o(d).detail)==null?void 0:y.headUrl)||o(We).sea,onError:M},null,8,["src"])]),a("div",kt,[a("div",xt,T(o(d).detail.authorName),1),a("div",It,[a("span",bt,T(o(Ue)((C=o(d).detail)==null?void 0:C.createTime)),1),a("span",Tt,"阅读 "+T(($=o(d).detail)==null?void 0:$.readCount),1)])])]),a("div",Mt,[w(S,{class:"el-image",src:(E=o(d).detail)==null?void 0:E.coverImage,fit:"cover"},null,8,["src"])]),a("div",Ct,T((H=o(d).detail)==null?void 0:H.abstract),1),l.value?(n(),m(tt,{key:0,mackdown:l.value,class:"preview-content","on-preview-image":c},null,8,["mackdown"])):g("",!0),a("div",St,[a("div",Et,[P(" 分类: "),a("span",$t,T((z=o(d).detail)==null?void 0:z.classify),1)]),a("div",Rt,[P(" 标签: "),a("span",Dt,T((q=o(d).detail)==null?void 0:q.tag),1)])]),(O=o(d).detail)!=null&&O.id?(n(),m(ze,{key:1,"article-id":(F=o(d).detail)==null?void 0:F.id,"author-id":(j=o(d).detail)==null?void 0:j.authorId,class:"comment-detail","on-preview-image":c},null,8,["article-id","author-id"])):g("",!0)]),o(d).tocTitles.length?(n(),b("div",At,[w(ft)])):g("",!0)],544),i.value>=500?(n(),m(D,{key:0,"on-scroll-to":u})):g("",!0),w(A,{previewVisible:e.value,"onUpdate:previewVisible":f[0]||(f[0]=le=>e.value=le),"select-image":{url:r.value},"close-on-click-modal":""},null,8,["previewVisible","select-image"])])),[[t,o(d).loading]])}}});const Zt=V(Nt,[["__scopeId","data-v-1a30b9d0"]]);export{Zt as default};
