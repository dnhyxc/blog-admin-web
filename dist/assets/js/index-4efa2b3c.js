var w=(p,d,c)=>new Promise((r,t)=>{var g=a=>{try{b(c.next(a))}catch(l){t(l)}},v=a=>{try{b(c.throw(a))}catch(l){t(l)}},b=a=>a.done?r(a.value):Promise.resolve(a.value).then(g,v);b((c=c.apply(p,d)).next())});import{_ as T}from"./index-9942da33.js";import{d as A,aJ as y,bb as E,aL as M,bd as L,b3 as N,be as q,bf as D,o as f,f as C,g as k,i as s,w as o,F as J,r as O,j as h,b6 as j,aU as V,l as R,_ as G,bO as z,aK as H,h as B,J as $,C as P,D as Q}from"./index-c3904695.js";/* empty css                     *//* empty css                  *//* empty css                 */import{M as W}from"./index-31e04a31.js";import{U as X}from"./index-61c789b9.js";import{I as Y}from"./index-1ea276e6.js";import{s as U,k as Z,u as S,g as ee}from"./index-fe386976.js";import{u as ae}from"./index-11a757ea.js";/* empty css                   *//* empty css                   *//* empty css                    *//* empty css                */const te={class:"bind-wrap"},se={class:"content"},oe={class:"inp-wrap"},ne={class:"actions"},le=A({__name:"ResetBind",props:{visible:{type:Boolean,default:!1},getValues:{type:Function,default:()=>{}}},emits:["update:visible"],setup(p,{emit:d}){const c=p,r=y(),t=E({domains:[]});M(()=>{c.visible&&(t.domains=U.bindUserInfo.map(a=>({key:a.userId,value:a.username})))});const g=a=>{const l=t.domains.indexOf(a);l!==-1&&t.domains.splice(l,1)},v=()=>{t.domains.push({key:ae(),value:""})},b=a=>{a&&a.validate(l=>w(this,null,function*(){if(l){const n=t.domains.map(_=>_.value),e=yield Z.bindAccount({usernames:n}),u=e.findUsernames.map((_,m)=>({userId:e.bindUserIds[m],username:_}));U.setBindUsernames(u),d("update:visible",!1)}else return!1}))};return(a,l)=>{const n=L,e=N,u=q,_=D;return f(),C("div",te,[k("div",se,[s(_,{ref_key:"formRef",ref:r,model:t,"label-width":"110px",class:"form-wrap"},{default:o(()=>[(f(!0),C(J,null,O(t.domains,(m,I)=>(f(),h(u,{key:m.key,label:`绑定账号名${I+1}`,prop:`domains.${I}.value`,rules:{required:!0,message:"请输入需要绑定的前台账号名称"},class:"form-item-custom"},{default:o(()=>[k("div",oe,[s(n,{modelValue:m.value,"onUpdate:modelValue":x=>m.value=x,placeholder:"请输入需要绑定的前台账号名称"},null,8,["modelValue","onUpdate:modelValue"]),I>0?(f(),h(e,{key:0,class:"del-btn",link:"",onClick:j(x=>g(m),["prevent"])},{default:o(()=>[V("删除")]),_:2},1032,["onClick"])):R("",!0)])]),_:2},1032,["label","prop"]))),128)),s(u,{class:"form-item-action"},{default:o(()=>[k("div",ne,[s(e,{type:"primary",class:"action-btn",onClick:l[0]||(l[0]=m=>b(r.value))},{default:o(()=>[V("确定修改")]),_:1}),t.domains.length<5?(f(),h(e,{key:0,class:"action-btn",onClick:v},{default:o(()=>[V(" 增加绑定账号 ")]),_:1})):R("",!0)])]),_:1})]),_:1},8,["model"])])])}}});const re=G(le,[["__scopeId","data-v-339a8c42"]]),ie=p=>(P("data-v-5562316d"),p=p(),Q(),p),ue=ie(()=>k("div",{class:"header"},"账号设置",-1)),de={class:"bind-wrap"},me={class:"actions"},ce=A({__name:"index",setup(p){const d=y(!1),c=y(),r=E({domains:[],bindAccount:"",username:""}),t=y(S.headUrl||""),g=y(!1),v=y("");z(()=>{g.value||v.value&&ee.removeFile(v.value)}),M(()=>w(this,null,function*(){var n;d.value||(r.domains=(n=U.bindUserInfo)==null?void 0:n.map((e,u)=>({key:e.userId,value:e.username})))})),H(()=>w(this,null,function*(){var n;yield U.getBindUserInfo(),r.username=(n=S)==null?void 0:n.username}));const b=n=>{v.value=n},a=()=>{d.value=!0},l=n=>{n&&n.validate(e=>w(this,null,function*(){if(e)(yield U.updateUserInfo({username:r.username,headUrl:t.value}))&&(g.value=!0);else return!1}))};return(n,e)=>{const u=q,_=L,m=N,I=D,x=T;return f(),h(x,{loading:B(U).loading,class:"setting-wrap"},{default:o(()=>[ue,s(I,{ref_key:"formRef",ref:c,model:r,"label-width":"110px",class:"form-wrap"},{default:o(()=>[s(u,{prop:"avatar",label:"用户头像",class:"form-item form-item-avatar"},{default:o(()=>[s(X,{"file-path":t.value,"onUpdate:file-path":e[0]||(e[0]=i=>t.value=i),"fixed-number":[130,130],"get-upload-url":b},{preview:o(()=>[s(Y,{url:t.value||B($).sea,"transition-img":B($).sea,class:"avatar-uploader avatar"},null,8,["url","transition-img"])]),_:1},8,["file-path"])]),_:1}),s(u,{prop:"username",label:"用户名称",rules:[{required:!0,message:"请输入需要更改的名称",trigger:"blur"}],class:"form-item"},{default:o(()=>[s(_,{modelValue:r.username,"onUpdate:modelValue":e[1]||(e[1]=i=>r.username=i),placeholder:"请输入需要更改的名称"},null,8,["modelValue"])]),_:1}),k("div",de,[(f(!0),C(J,null,O(r.domains,(i,F)=>(f(),h(u,{key:i.key,label:"绑定账号名 "+(F+1),prop:"domains."+F+".value",rules:{required:!0,message:"请输入需要绑定的前台账号名称",trigger:"blur"},class:"form-item-custom"},{default:o(()=>[s(_,{modelValue:i.value,"onUpdate:modelValue":K=>i.value=K,disabled:"",placeholder:"请输入需要绑定的前台账号名称"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label","prop"]))),128)),s(m,{class:"del-btn",type:"primary",link:"",onClick:j(a,["prevent"])},{default:o(()=>[V("重新设置绑定账号")]),_:1},8,["onClick"])]),s(u,{class:"form-item-action"},{default:o(()=>[k("div",me,[s(m,{type:"primary",class:"action-btn",onClick:e[2]||(e[2]=i=>l(c.value))},{default:o(()=>[V("确定修改")]),_:1})])]),_:1})]),_:1},8,["model"]),s(W,{visible:d.value,"onUpdate:visible":e[4]||(e[4]=i=>d.value=i),title:"账号绑定","need-footer":!1},{default:o(()=>[s(re,{visible:d.value,"onUpdate:visible":e[3]||(e[3]=i=>d.value=i)},null,8,["visible"])]),_:1},8,["visible"])]),_:1},8,["loading"])}}});const Ce=G(ce,[["__scopeId","data-v-5562316d"]]);export{Ce as default};
